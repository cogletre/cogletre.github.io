<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Tree House Recipes</title>
		
		<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
		<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
		<script src="https://code.jquery.com/jquery-migrate-3.3.1.min.js"></script>
		<script src="scripts/jquery.flexslider-min.js"></script>
		
		<link rel="stylesheet" href="recipes-stylesheet.css">
		<script src="recipes-scripts.js"></script>
		
		
		<script>
			var recipeJson;
			var recipeArr;
			$(function() {
				loadRecipes(function(resp) {
					recipeJson=JSON.parse(resp);
					recipeArr=recipeJson['recipes'];
					var recipeDiv;
					for(var r=0;r<recipeArr.length;r++) {
						$tempDiv=document.createElement('div');
						$tempDiv.id='recipe'+r;
						$tempDiv.className='list-item recipe'+r;
						$tempDiv.style.backgroundImage='url('+recipeArr[r].image+')';
						
						$tempName=document.createElement('div');
						$tempName.className='recipe-name';
						$tempName.innerHTML=recipeArr[r].name;
						
						$tempLink=document.createElement('a');
						$tempLink.className='recipe-link';
						$tempLink.id='recipe'+r;
						
						$tempDiv.appendChild($tempName);
						$tempDiv.appendChild($tempLink);
						
						$('#list-wrapper')[0].appendChild($tempDiv);
					}
					$('.recipe-link').click(function() {
						$recObj=$('.recipe-link');
						$recArr=Object.values($recObj);
						$currId=this.id;
						$currLinkNum=$recArr.indexOf(this);
						openModal($currLinkNum);
					});
				});
			});
		</script>
	</head>

	<body>
		<div id="body-wrapper">
			<header>
				<h1>Tree House Recipes</h1>
			</header>
			
			<div id="filters-container" class="filters-container">
				<div id="filters-wrapper" class="filters-wrapper">
					<div id="filters" class="filters">
						<div class="filter ingredient-filter">
							<label for="ingredients">Main ingredient:</label>
							<select id="ingredients" name="ingredients">
								<option>Select...</option>
								<option value="chicken">Chicken</option>
								<option value="shrimp">Shrimp</option>
								<option value="fish">Fish</option>
							</select>
						</div>
						<div class="filter restrictions-filter">
							<label for="restrictions">Dietary restrictions:</label>
							<select id="restrictions" name="restrictions">
								<option>Select...</option>
								<option value="vegetarian">Vegetarian</option>
								<option value="gluten-free">Gluten-free</option>
								<option value="vegan">Vegan</option>
								<option value="dairy-free">Dairy-free</option>
							</select>
						</div>
					</div>
				</div>
			</div>
			<div id="list-container" class="list-container">
				<div id="list-wrapper" class="list-wrapper"></div>
			</div>
			<div id="recipe-modal" class="modal-container">
				<div class="modal-wrapper">
					<div id="close-modal">&times;</div>
					<div id="modal-image"></div>
					<div class="modal-text">
						<div id="recipe-name"></div>
						<div id="recipe-yield"></div>
						<div id="recipe-time"></div>
						<div id="recipe-description"></div>
						<div id="recipe-ingredients">
							<span>Ingredients:</span>
							<ul id="ingredient-list"></ul>
						</div>
						<div id="recipe-instructions">
							<span>Instructions:</span>
							<ol id="instruction-list"></ol>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script>
			function openModal(recipeId) {
				$recNum=recipeId;
				console.log('clicked ' + recipeId);
				$currRecArr=recipeArr[$recNum];
				console.log($currRecArr);
				$('#recipe-modal #modal-image').css('background-image','url('+$currRecArr.image+')');
				$('#recipe-modal #recipe-name').text($currRecArr.name);
				$('#recipe-modal #recipe-yield').text($currRecArr.yield);
				$('#recipe-modal #recipe-time').text($currRecArr.cookTime);
				$('#recipe-modal #recipe-description').text($currRecArr.description);
				$recIngArr=$currRecArr.ingredients;
				$ingredientList=$('#ingredient-list');
				$prepList=$('#instruction-list');
				for(var i=0;i<$recIngArr.length;i++) {
					$ingLi=document.createElement('li');
					$ingLi.innerHTML=$recIngArr[i];
					$ingredientList[0].appendChild($ingLi);
				}
				$recInstArr=$currRecArr.preparation;
				for(var p=0;p<$recInstArr.length;p++) {
					$prepLi=document.createElement('li');
					$prepLi.innerHTML=$recInstArr[p];
					$prepList[0].appendChild($prepLi);
				}
				return;
			}
		</script>
	</body>
</html>